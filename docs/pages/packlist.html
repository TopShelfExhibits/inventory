<div id="tabSystem">
</div>
<!--
EXAMPLE OF A MODAL
<div class="modal"> 
    <div class="modal-content">
        <div class="modal-header">Open Pack List:<span class="modal-close">&times;</span></div>
        <h2>New Tab</h2>
        <p>Content for the new tab goes here.</p>
    </div>
</div>
-->


<script type="module">
    import { TabManager, GoogleSheetsService } from './js/index.js';
    
    const SPREADSHEET_ID = '1mPHa1lEkhHhZ7WYTDetJyUrhjwVEb3l5J1EBLcO17Z0';

    await TabManager.addTabNavigation('tabSystem', true);

    // this fails if it is an async function
    document.querySelector('#tabSystem .new-tab-button')?.addEventListener('click', () => {
        
        // Generate a new modal for creating a new tab
        const modal = document.createElement('div');
        modal.classList.add('modal');
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header"><span class="modal-close">&times;</span></div>
                <div id="tabs-list">
                    <p class="loading-message">Loading tabs...</p>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        document.querySelector('.modal-close')?.addEventListener('click', () => {
            // Close the modal when the close button is clicked
            modal.remove();
        });

        try {
            const sheetTabs = GoogleSheetsService.getSheetTabs(SPREADSHEET_ID).then((sheetTabs) => {
                modal.querySelector('#tabs-list').innerHTML = ''; // Clear loading message
                for (const tabName of sheetTabs) {
                    // if the tab name is TEMPLATE then skip it
                    if (tabName === 'TEMPLATE') continue;
                    
                    const tabButton = document.createElement('button');
                    tabButton.classList.add('tab-button');
                    tabButton.textContent = tabName;
                    modal.querySelector('#tabs-list').appendChild(tabButton);
                    tabButton.addEventListener('click', () => {
                        // Get the content of the tab from the Google Sheets API
                        GoogleSheetsService.getPackListContent(SPREADSHEET_ID, tabName).then((tabElement) => {
                            // Add the new tab with the content
                            TabManager.addNewTab(tabName, tabElement.outerHTML, true, tabName);

                        }).catch((error) => {
                            console.error('Error loading sheet content:', error);
                            const errorMessage = document.createElement('p');
                            errorMessage.textContent = 'Failed to load spreadsheet content';
                            TabManager.addNewTab(tabName, errorMessage, true, tabName);
                        });
                        
                        modal.remove();
                    });
                }
            });
        } catch (error) {
            console.error('Error loading sheet tabs:', error);
            const errorMessage = document.createElement('p');
            errorMessage.textContent = 'Failed to load spreadsheet tabs';
            modal.querySelector('#tabs-list').appendChild(errorMessage);
        }
        
        //TabManager.addNewTab('New Tab', 'new-tab-content', true);
    });

    // once this script finishes, remove it from the dom
    const script = document.querySelector('script[type="module"]');
    if (script) {
        script.parentNode.removeChild(script);
    }
</script>